{% extends "base.html" %}

{% block title %}Add New Project - PyOrchestrator{% endblock %}

{% block content %}
<h1>Add New Project</h1>

<div class="card">
    <div class="card-body">
        <form action="/projects/add" method="post">
            <div class="mb-3">
                <label for="name" class="form-label">Project Name</label>
                <input type="text" class="form-control" id="name" name="name" required>
            </div>
            <div class="mb-3">
                <label for="source_type" class="form-label">Source Type</label>
                <select class="form-select" id="source_type" name="source_type" onchange="toggleSourceFields()" required>
                    <option value="Local" selected>Local</option>
                    <option value="GitHub">GitHub</option>
                </select>
            </div>
            <div class="mb-3" id="source_url_field" style="display: none;">
                <label for="source_url" class="form-label">GitHub URL</label>
                <input type="text" class="form-control" id="source_url" name="source_url" placeholder="https://github.com/user/repo.git">
            </div>
            <div class="mb-3">
                <label for="source_path" class="form-label">Source Path</label>
                <input type="text" class="form-control" id="source_path" name="source_path" placeholder="/path/to/your/project" required>
                <div class="form-text">For GitHub projects, this is the parent directory where the repo will be cloned.</div>
            </div>
            <div class="mb-3">
                <label for="main_script" class="form-label">Main Script</label>
                <input type="text" class="form-control" id="main_script" name="main_script" placeholder="main.py" required>
            </div>
            <div class="mb-3">
                <label for="arguments" class="form-label">Arguments (optional)</label>
                <input type="text" class="form-control" id="arguments" name="arguments">
            </div>
            <div class="mb-3">
                <label for="environment_type" class="form-label">Environment Type</label>
                <select class="form-select" id="environment_type" name="environment_type" required>
                    <option value="uv">uv</option>
                    <option value="venv">venv</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary"><i class="bi bi-plus-circle"></i> Add Project</button>
            <a href="/" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
</div>

<script>
    function toggleSourceFields() {
        const sourceType = document.getElementById('source_type').value;
        const sourceUrlField = document.getElementById('source_url_field');
        const sourceUrlInput = document.getElementById('source_url');
        if (sourceType === 'GitHub') {
            sourceUrlField.style.display = 'block';
            sourceUrlInput.setAttribute('required', 'required');
        } else {
            sourceUrlField.style.display = 'none';
            sourceUrlInput.removeAttribute('required');
        }
    }
    // Initial call to set visibility based on default value
    toggleSourceFields();
</script>
{% endblock %}