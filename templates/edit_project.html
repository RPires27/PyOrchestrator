{% extends "base.html" %}

{% block title %}Edit Project - PyOrchestrator{% endblock %}

{% block content %}
<h1>Edit Project</h1>

<div class="card">
    <div class="card-body">
        <form action="/projects/{{ project.id }}/edit" method="post">
            <div class="mb-3">
                <label for="name" class="form-label">Project Name</label>
                <input type="text" class="form-control" id="name" name="name" value="{{ project.name }}" required>
            </div>
            <div class="mb-3">
                <label for="source_type" class="form-label">Source Type</label>
                <select class="form-select" id="source_type" name="source_type" onchange="toggleSourceFields()" required>
                    <option value="Local" {% if project.source_type == 'Local' %}selected{% endif %}>Local</option>
                    <option value="GitHub" {% if project.source_type == 'GitHub' %}selected{% endif %}>GitHub</option>
                </select>
            </div>
            <div class="mb-3" id="source_url_field">
                <label for="source_url" class="form-label">GitHub URL</label>
                <input type="text" class="form-control" id="source_url" name="source_url" value="{{ project.source_url or '' }}">
            </div>
            <div class="mb-3">
                <label for="source_path" class="form-label">Source Path</label>
                <input type="text" class="form-control" id="source_path" name="source_path" value="{{ project.source_path }}" required>
            </div>
            <div class="mb-3">
                <label for="main_script" class="form-label">Main Script</label>
                <input type="text" class="form-control" id="main_script" name="main_script" value="{{ project.main_script }}" required>
            </div>
            <div class="mb-3">
                <label for="arguments" class="form-label">Arguments (optional)</label>
                <input type="text" class="form-control" id="arguments" name="arguments" value="{{ project.arguments or '' }}">
            </div>
            <div class="mb-3">
                <label for="environment_type" class="form-label">Environment Type</label>
                <select class="form-select" id="environment_type" name="environment_type" required>
                    <option value="uv" {% if project.environment_type == 'uv' %}selected{% endif %}>uv</option>
                    <option value="venv" {% if project.environment_type == 'venv' %}selected{% endif %}>venv</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary"><i class="bi bi-check-circle"></i> Update Project</button>
            <a href="/projects/{{ project.id }}" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
</div>

<script>
    function toggleSourceFields() {
        const sourceType = document.getElementById('source_type').value;
        const sourceUrlField = document.getElementById('source_url_field');
        const sourceUrlInput = document.getElementById('source_url');
        if (sourceType === 'GitHub') {
            sourceUrlField.style.display = 'block';
            sourceUrlInput.setAttribute('required', 'required');
        } else {
            sourceUrlField.style.display = 'none';
            sourceUrlInput.removeAttribute('required');
        }
    }
    // Initial call to set visibility based on default value
    toggleSourceFields();
</script>
{% endblock %}