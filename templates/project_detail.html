{% extends "base.html" %}

{% block title %}Project: {{ project.name }} - PyOrchestrator{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><span class="text-muted">Project:</span> {{ project.name }}</h1>
    <div>
        <a href="/" class="btn btn-secondary"><i class="bi bi-arrow-left"></i> Back to Dashboard</a>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0">Project Details</h2>
        <div>
            <a href="/projects/{{ project.id }}/edit" class="btn btn-primary btn-sm"><i class="bi bi-pencil"></i> Edit Project</a>
            <form action="/projects/{{ project.id }}/run" method="post" style="display:inline;">
                <button type="submit" class="btn btn-success btn-sm"><i class="bi bi-play-circle"></i> Run Project Now</button>
            </form>
        </div>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <p><strong>ID:</strong> {{ project.id }}</p>
                <p><strong>Name:</strong> {{ project.name }}</p>
                <p><strong>Source Type:</strong> {{ project.source_type }}</p>
                <p><strong>Environment Type:</strong> {{ project.environment_type }}</p>
            </div>
            <div class="col-md-6">
                <p><strong>Source URL:</strong> {{ project.source_url if project.source_url else 'N/A' }}</p>
                <p><strong>Source Path:</strong> {{ project.source_path }}</p>
                <p><strong>Main Script:</strong> {{ project.main_script }}</p>
                <p><strong>Arguments:</strong> {{ project.arguments if project.arguments else 'N/A' }}</p>
            </div>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0">Schedules</h2>
        <a href="/schedules/add?project_id={{ project.id }}" class="btn btn-primary btn-sm"><i class="bi bi-plus-circle"></i> Add Schedule</a>
    </div>
    <div class="card-body">
        <table class="table table-hover align-middle">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Cron Schedule</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for schedule in schedules %}
                <tr>
                    <td>{{ schedule.id }}</td>
                    <td>{{ schedule.name }}</td>
                    <td><code>{{ schedule.cron_schedule }}</code></td>
                    <td>
                        <a href="/schedules/{{ schedule.id }}/edit" class="btn btn-sm btn-outline-secondary"><i class="bi bi-pencil"></i> Edit</a>
                        <form action="/schedules/{{ schedule.id }}/delete" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this schedule?');">
                            <button type="submit" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i> Delete</button>
                        </form>
                        <form action="/schedules/{{ schedule.id }}/run" method="post" style="display:inline;">
                            <button type="submit" class="btn btn-sm btn-outline-success"><i class="bi bi-play-circle"></i> Run Now</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2 class="h5 mb-0">Recent Runs</h2>
    </div>
    <div class="card-body">
        <table class="table table-hover align-middle">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Schedule ID</th>
                    <th>Status</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for run in runs %}
                <tr>
                    <td>{{ run.id }}</td>
                    <td>{{ run.schedule_id if run.schedule_id else 'Manual' }}</td>
                    <td>
                        {% if run.status == 'completed' %}
                        <span class="badge bg-success">Completed</span>
                        {% elif run.status == 'failed' %}
                        <span class="badge bg-danger">Failed</span>
                        {% elif run.status == 'running' %}
                        <span class="badge bg-primary">Running</span>
                        {% else %}
                        <span class="badge bg-secondary">{{ run.status }}</span>
                        {% endif %}
                    </td>
                    <td>{{ run.start_time.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td>{{ run.end_time.strftime('%Y-%m-%d %H:%M:%S') if run.end_time else 'N/A' }}</td>
                    <td><a href="/runs/{{ run.id }}" class="btn btn-sm btn-outline-info"><i class="bi bi-file-text"></i> View Log</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
